---
title: "ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ê²½ë¡œë¥¼ S3 ë¡œ ë³€ê²½"
date: 2025-08-06 01:56:00 +09:00
categories: [Infra, AWS]
tags:
  [
    Spring,
    AWS,
    S3
  ]
---

ê¸°ì¡´ì—ëŠ” aws ê°€ ì•„ë‹ˆë¼ PC ì—ì„œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í–ˆê¸° ë•Œë¬¸ì— ë¡œì»¬ PC ì— ì‚¬ì§„ì„ ì €ì¥í–ˆë‹¤.<br>
í•˜ì§€ë§Œ aws ë¡œ ë³€ê²½í•˜ë©´ì„œ ê¸°ì¡´ê²½ë¡œì— íŒŒì¼ì„ ì €ì¥í•  ìˆ˜ ì—†ê²Œë˜ì—ˆë‹¤.<br>
ë‹¨ìˆœí•˜ê²Œ íŒŒì¼ë“¤ì„ EC2 ë‚´ë¶€ì— ì €ì¥í•´ë„ ë˜ì§€ë§Œ S3 ì— ì €ì¥í•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.<br>
í™ˆí˜ì´ì§€ì— ë‚˜ì™€ìˆëŠ” ì¥ì ì„ ì‚´í´ë³´ì.<br>

- í™•ì¥ì„± : S3ë¥¼ ì‚¬ìš©í•˜ë©´ íƒì›”í•œ ì„±ëŠ¥ìœ¼ë¡œ ì—‘ì‚¬ë°”ì´íŠ¸ ë‹¨ìœ„ê¹Œì§€ ê±°ì˜ ëª¨ë“  ìš©ëŸ‰ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. S3ëŠ” íƒ„ë ¥ì ì´ë©° ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³  ì œê±°í•¨ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì¦ê°€í•˜ê³  ì¤„ì–´ë“­ë‹ˆë‹¤. ìŠ¤í† ë¦¬ì§€ë¥¼ í”„ë¡œë¹„ì €ë‹í•  í•„ìš”ê°€ ì—†ê³ , ì‚¬ìš©í•œ ë§Œí¼ë§Œ ë¹„ìš©ì„ ì§€ë¶ˆí•˜ë©´ ë©ë‹ˆë‹¤.
- ë‚´êµ¬ì„± ë° ê°€ìš©ì„± : Amazon S3ëŠ” í´ë¼ìš°ë“œì—ì„œ ê°€ì¥ ë‚´êµ¬ì„±ì´ ë›°ì–´ë‚œ ìŠ¤í† ë¦¬ì§€ì™€ ì—…ê³„ ìµœê³ ì˜ ê°€ìš©ì„±ì„ ì œê³µí•©ë‹ˆë‹¤. ê³ ìœ í•œ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” S3ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 99.999999999%ì˜ ë°ì´í„° ë‚´êµ¬ì„±ê³¼ 99.99%ì˜ ê°€ìš©ì„±ì„ ì œê³µí•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, í´ë¼ìš°ë“œì—ì„œ ê°€ì¥ ê°•ë ¥í•œ SLAì˜ ì§€ì›ì„ ë°›ìŠµë‹ˆë‹¤.
- ë³´ì•ˆ ë° ë°ì´í„° ë³´í˜¸ : íƒì›”í•œ ë³´ì•ˆ, ë°ì´í„° ë³´í˜¸, ê·œì • ì¤€ìˆ˜ ë° ì•¡ì„¸ìŠ¤ ì œì–´ ê¸°ëŠ¥ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤. S3ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì•ˆì „í•˜ê³  ë¹„ê³µê°œì ì´ë©° ì•”í˜¸í™”ë˜ì–´ ìˆìœ¼ë©°, S3 ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ìš”ì²­ì„ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë‹¤ì–‘í•œ ê°ì‚¬ ê¸°ëŠ¥ë„ ì§€ì›í•©ë‹ˆë‹¤.
- ì €ë ´í•œ ê°€ê²©ê³¼ ìµœìƒì˜ ì„±ëŠ¥ : S3ëŠ” ëª¨ë“  ì›Œí¬ë¡œë“œì— ìµœê³ ì˜ ê°€ê²© ëŒ€ë¹„ ì„±ëŠ¥ì„ ê°–ì¶˜ ë‹¤ì–‘í•œ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ì™€ ìë™í™”ëœ ë°ì´í„° ìˆ˜ëª…ì£¼ê¸° ê´€ë¦¬ë¥¼ ì œê³µí•˜ë¯€ë¡œ ìì£¼ ì•¡ì„¸ìŠ¤í•˜ì§€ ì•Šê±°ë‚˜ ë“œë¬¼ê²Œ ì•¡ì„¸ìŠ¤í•˜ëŠ” ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ ë¹„ìš© íš¨ìœ¨ì ì¸ ë°©ì‹ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. S3ëŠ” ë³µì›ë ¥, ìœ ì—°ì„±, ë ˆì´í„´ì‹œ ë° ì²˜ë¦¬ëŸ‰ì„ ì œê³µí•˜ì—¬ ìŠ¤í† ë¦¬ì§€ê°€ ì„±ëŠ¥ì„ ì œí•œí•˜ì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.

ì´ ì¤‘ ë‚´ê°€ ì§‘ì¤‘í•œ ë¶€ë¶„ì€ í™•ì¥ì„±ì´ë‹¤. ì‚¬ìš©ì ì…ì¥ì—ì„œ S3 ëŠ” ë¬´í•œí•œ ìš©ëŸ‰ì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ìš©ëŸ‰ì´ ê°€ë“ì°¨ì„œ ë””ìŠ¤í¬ë¥¼ ì¦ì„¤í•˜ê±°ë‚˜ ì˜¤ë˜ëœ ë°ì´í„°ë¥¼ ë°±ì—… í›„ ë³„ë„ ë³´ê´€í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.<br>

## íŒŒì¼ ì—…ë¡œë“œ ë°©ì‹

íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ëŠ” ë°©ì‹ì€ MultipartFile ì—…ë¡œë“œ ë°©ì‹ì„ ì‚¬ìš©í•˜ê³ , íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í•  ë•ŒëŠ” Presigned URL ë°©ì‹ì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤.<br>
<br>

**MultipartFile ì—…ë¡œë“œ ë°©ì‹ ì±„ìš©ì´ìœ **<br>
ì—…ë¡œë“œ ê³¼ì •ì—ì„œ resize í•˜ëŠ” ê¸°ëŠ¥ì„ ë„£ì„ ìˆ˜ë„ ìˆê³  ê¸°ì¡´ í”„ë¡œì íŠ¸ì— íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ë¡œì§ì„ í¬ê²Œ ë³€í˜•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.<br>

**Presigned URL ì±„ìš©ì´ìœ **<br>
ì‚¬ìš©ìê°€ profile image ë¥¼ ì½ê±°ë‚˜ ì²¨ë¶€íŒŒì¼ì„ ë‹¤ìš´ë°›ì„ ë•Œ, ë™ì ì¸ URL ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê³  ì‹¶ì—ˆë‹¤.<br>
ê³ ì • URL ì„ ì‚¬ìš©í•˜ë©´ ë¬´ì‘ìœ„ ëŒ€ì… ê³µê²©ì— ë‹¤ë¥¸ íŒŒì¼ì´ ë…¸ì¶œë  ìˆ˜ ìˆëŠ”ë°, ì´ê±¸ ë°©ì§€í•˜ê¸° ìœ„í•´ Presigned URL ë°©ì‹ìœ¼ë¡œ ì±„íƒí–ˆë‹¤.<br>

> Presigned URL<br>
> ë¯¸ë¦¬ ì„œëª…ëœ URL ì´ë€ ì˜ë¯¸ë¡œ URL ì— ì„œëª…ì„ ë‚¨ê²¨ í•´ë‹¹ URL ì„ í†µí•´ì„œ ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œí•œë‹¤.<br>
> Presigned URL ì—ëŠ” ë§Œë£Œì‹œê°„ë„ ìˆê¸° ë•Œë¬¸ì— URL ì— íƒˆì·¨ë˜ë„ ë§Œë£Œë˜ë©´ ê°ì²´ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.<br>


## S3 bucket ìƒì„±

ì´ì „ í¬ìŠ¤íŒ…ì„ ì°¸ê³ í•˜ì—¬ S3 bucket ì„ ë§Œë“ ë‹¤.

- ACL ë¹„í™œì„±í™”
- ëª¨ë“  public access ì°¨ë‹¨

IAM Role ê³¼ Presigned URL ë§Œ ì‚¬ìš©í•˜ì—¬ S3 ì— ì ‘ê·¼í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ACL ë¹„í™œì„±í™” ë° public access ë¥¼ ì°¨ë‹¨í•´ë„ ë¬¸ì œ ì—†ë‹¤.<br>

## IAM Role ìƒì„±
EC2 ì—ì„œ S3 ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Role ì„ ë§Œë“ ë‹¤.<br>

![ì‚¬ì§„1](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/1.png?raw=true)<br>

ì¢Œì¸¡ì—ì„œ ì—­í•  ì„ íƒ - ì—­í•  ìƒì„± ë²„íŠ¼ í´ë¦­<br>

![ì‚¬ì§„2](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/2.png?raw=true)<br>
ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì—”í„°í‹° ìœ í˜• - aws ì„œë¹„ìŠ¤<br>
ì„œë¹„ìŠ¤ëŠ” ec2 ì„ íƒ<br>

![ì‚¬ì§„3](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/3.png?raw=true)<br>

ê¶Œí•œ ì •ì±…ì€ ë‚˜ì¤‘ì— ë§Œë“¤ê±°ë¼ ì„ íƒí•˜ì§€ ì•Šê³  ë„˜ì–´ê°€ë„ ë¨(ë¯¸ë¦¬ ë§Œë“¤ê³  ì—¬ê¸°ì„œ ì„ íƒí•´ë„ OK)<br>

![ì‚¬ì§„4](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/4.png?raw=true)<br>

ì´ë¦„ê³¼ ì„¤ëª…ì€ ë§ˆìŒëŒ€ë¡œ ì •í•˜ê³  ì—­í•  ìƒì„±ë²„íŠ¼ í´ë¦­<br>

![ì‚¬ì§„5](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/5.png?raw=true)<br>

ì—­í•  ëª©ë¡ì— ë°©ê¸ˆ ë§Œë“  ì—­í• ì´ ìˆìŒ. í´ë¦­<br>

![ì‚¬ì§„6](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/6.png?raw=true)<br>

ì•„ê¹Œ ê¶Œí•œì •ì±… ì„ íƒì•ˆí–ˆë˜ê±° ì´ì œ ë§Œë“¤ê±°ì„. ê¶Œí•œ ì¶”ê°€ ì„ íƒ<br>
ì¸ë¼ì¸ ì •ì±… ìƒì„± í´ë¦­<br>

![ì‚¬ì§„7](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/7.png?raw=true)<br>

ì •ì±… í¸ì§‘ê¸°ê°€ ë‚˜ì˜¬ê±°ì„. ì •ì±… ë§Œë“œëŠ” ê·œì¹™ì„ ì•Œë©´ JSON ìœ¼ë¡œ ì§ì ‘ ë§Œë“¤ì–´ë„ ë¨.<br>
ì—¬ê¸°ì„œëŠ” í´ë¦­ìœ¼ë¡œ ë§Œë“¤ê²ƒì„.<br>
S3 ì— ì ‘ê·¼í•  ê²ƒì´ë¯€ë¡œ S3 ì„ íƒ<br>

![ì‚¬ì§„8](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/8.png?raw=true)<br>

ì‘ì—…ì—ëŠ” DeleteObject, PutObject, GetObject ë¥¼ ì„ íƒí•˜ê³  ì²´í¬ê¹Œì§€ í•´ì¤€ë‹¤.<br>
ê° ì‘ì—…ì— ëŒ€í•œ ì„¤ëª…ì€ ì •ë³´ë¥¼ í´ë¦­í•˜ë©´ ë³¼ ìˆ˜ ìˆë‹¤.<br>
Object ëŠ” bucket ì— ì €ì¥ë˜ëŠ” íŒŒì¼ì„ ì˜ë¯¸í•œë‹¤.<br>

![ì‚¬ì§„9](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/9.png?raw=true)<br>

ì •ì±…ì„ ì ìš©ë‹¹í•  ë¦¬ì†ŒìŠ¤ë¥¼ ì„ íƒí•œë‹¤. ìœ„ì—ì„œ ë§Œë“  ë²„í‚·ì˜ ì´ë¦„ì„ ì‘ì„±í•˜ë©´ ëœë‹¤.<br>


ë¦¬ì†ŒìŠ¤ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŒ. 'ëª¨ë‘'ë¥¼ ì„ íƒí•˜ë©´ ëª¨ë“  S3 bucket ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŒ.<br>
ì—¬ê¸°ì„œëŠ” íŠ¹ì •ì„ ì„ íƒí•˜ê³  ARN ì¶”ê°€ë¥¼ í´ë¦­<br>
Resource bucket name ì—ëŠ” ëŒ€ìƒì´ ë  bucket ì´ë¦„ì„ ì‘ì„±. ìœ„ì—ì„œ ë§Œë“  ë²„í‚· ì´ë¦„ì„ ë„£ì–´ì¤Œ.<br>
Resource Object name ì€ bucket ì—ì„œ ëŒ€ìƒì´ ë  ê²½ë¡œë¥¼ ì‘ì„±í•˜ë©´ë¨. ëª¨ë“  íŒŒì¼ì„ ëŒ€ìƒìœ¼ë¡œ ì‚¼ì„ê²ƒì´ê¸° ë•Œë¬¸ì— * ì…ë ¥<br>
ê·¸ëŸ¼ ë¦¬ì†ŒìŠ¤ arn ì´ ìë™ìœ¼ë¡œ ì‘ì„±ë¨. ë‚´ê°€ ë¦¬ì†ŒìŠ¤ arn ì„ ì§ì ‘ ì‘ì„±í•  ì¤„ ì•ˆë‹¤ë©´ ì‹œê°ì  ëŒ€ì‹  í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ì„œ ì‘ì„±í•˜ë©´ë¨.<br>

![ì‚¬ì§„10](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/10.png?raw=true)<br>

ARN ì¶”ê°€ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë‹¤ìŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤.<br>

![ì‚¬ì§„11](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/11.png?raw=true)<br>

ì •ì±…ì´ë¦„ì„ ì§€ì–´ì£¼ê³  ì •ì±… ìƒì„± ë²„íŠ¼ í´ë¦­<br>

## ec2 ì¸ìŠ¤í„´ìŠ¤ì— ë“±ë¡
ec2 ì¸ìŠ¤í„´íŠ¸ë¥¼ í´ë¦­í•˜ê³  ìƒë‹¨ì˜ ì‘ì—…ë²„íŠ¼ - ë³´ì•ˆ - IAM ì—­í•  ìˆ˜ì • - ë°©ê¸ˆ ë§Œë“  Role ì„ ì„ íƒ<br>
ì•— ì´ëŸ° IAM Role ì€ í•˜ë‚˜ë§Œ ì ìš© ê°€ëŠ¥í•˜ë‹¤ê³ í•˜ë„¤!<br>
ì´ëŸ¬ë©´ ë‘ ê¸°ëŠ¥ì„ í•©ì¹œ Role ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼í•œë‹¤.<br>
ë‚˜ëŠ” ìœ„ì—ì„œ ì‘ì„±í–ˆë˜ ê¶Œí•œì„ ê¸°ì¡´ì— ì ìš©ëœ Role ì— ì¶”ê°€í• ê²ƒì´ë‹¤.<br>
```ì¸ìŠ¤í„´ìŠ¤ ì„ íƒ``` - ```í•˜ë‹¨ì˜ ë³´ì•ˆ íƒ­``` - ```IAM ì—­í• ``` ì— ì ìš©ëœ ì—­í• ì´ ë³´ì¸ë‹¤. ë°”ë¡œê°€ê¸° í´ë¦­.<br>
```ê¶Œí•œ ì¶”ê°€``` - ```ì¸ë¼ì¸ ì •ì±… ìƒì„±```í›„ ì•„ê¹Œ í–ˆë˜ê±° ë‹¤ì‹œ í•˜ë©´ëœë‹¤.<br>

## build.gradle

```gradle
implementation("software.amazon.awssdk:s3:2.25.32")
```

build.gradle ì˜ dependencies ì— amazon s3 ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.<br>

## application.propertise

```properties
cloud.aws.region.s3=íŒŒì¼ì„ ì—…ë¡œë“œ í•  bucket ëª… ì‘ì„±
cloud.aws.region.static=ap-northeast-2
cloud.aws.region.stack.auto=false

spring.servlet.multipart.enabled=true # multipart file ì—…ë¡œë“œ ì§€ì›ì—¬ë¶€. default: true
spring.servlet.multipart.file-size-threshold=0B # ë””ìŠ¤í¬ì— ì €ì¥í•˜ì§€ ì•Šê³  ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ëŠ” ìµœì†Œ í¬ê¸°
spring.servlet.multipart.location=/opt/unichat/temp # íŒŒì¼ ì—…ë¡œë“œ ê³¼ì •ì— íŒŒì¼ì´ ì„ì‹œë¡œ ì €ì¥ë  ìœ„ì¹˜ ì§€ì •
spring.servlet.multipart.max-file-size=10MB # íŒŒì¼ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ. default: 1MB
spring.servlet.multipart.max-request-size=10MB # íŒŒì¼ ìš”ì²­ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ. default: 10MB
```

cloud.aws.region ë³€ìˆ˜ë“¤ì€ í•˜ë“œ ì½”ë”©ì„ í”¼í•˜ê¸° ìœ„í•´ ë³€ìˆ˜ë¡œ ì‘ì„±í•´ì£¼ê³ ,<br>
ì•„ë˜ spring.servlet.multipart ë³€ìˆ˜ë“¤ì€ default ê°’ì´ ìˆìœ¼ë¯€ë¡œ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.<br>

## config íŒŒì¼ ì‘ì„±

```java
@Configuration
public class AwsS3Config {
    @Value("${cloud.aws.region.static}")
    private String region;


    // ë°ì´í„° ì „ì†¡ í…ŒìŠ¤íŠ¸ í›„ ì •ìƒì´ë©´ key ëŠ” ì œê±°í•œë‹¤.
    private String accessKey = "ë‚˜ì˜ access key";
    private String secretKey = "ë‚˜ì˜ secret key";

    // IAM Role ì„ ì´ìš©í•´ ì ‘ê·¼í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©
    // access key ì™€ secret key ê°€ í•„ìš” ì—†ë‹¤.
    // @Bean
    // public S3Client s3Client() {
    //     return S3Client.builder()
    //             .region(Region.of(region))
    //             .credentialsProvider(DefaultCredentialsProvider.create())
    //             .build();
    // }
    
    // @Bean
    // public S3Presigner s3Presigner() {
    //     return S3Presigner.builder()
    //             .region(Region.of(region))
    //             .credentialsProvider(DefaultCredentialsProvider.create())
    //             .build();
    // }


    // ì•„ë˜ Bean ë‘ ê°œë„ local ì—ì„œ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ì‚­ì œí•œë‹¤.
    @Bean
    public S3Client s3Client() {
        AwsBasicCredentials awsCreds = AwsBasicCredentials.create(accessKey, secretKey);
        return S3Client.builder()
                .region(Region.of(region))
                .credentialsProvider(StaticCredentialsProvider.create(awsCreds))
                .build();
    }

    @Bean
    public S3Presigner s3Presigner() {
        AwsBasicCredentials awsCreds = AwsBasicCredentials.create(accessKey, secretKey);
        return S3Presigner.builder()
                .credentialsProvider(StaticCredentialsProvider.create(awsCreds))
                .region(Region.of(region))
                .build();
    }

}
```

AWS ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ëŠ” ì½”ë“œì´ë‹¤.<br>
ì›ë˜ëŠ” IAM Role ì„ ì´ìš©í•´ ì ‘ê·¼í•  ê²ƒì´ê¸° ë•Œë¬¸ì— access key ì™€ secret key ëŠ” í•„ìš”ì—†ë‹¤.<br>
í•˜ì§€ë§Œ local ì—ì„œ S3 bucket ìœ¼ë¡œ ë°ì´í„° ì „ì†¡ì„ ë¨¼ì € í…ŒìŠ¤íŠ¸ í•˜ê¸°ìœ„í•´ access key ë¥¼ ì‚¬ìš©í•´ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í–ˆë‹¤.<br>
local í™˜ê²½ì—ëŠ” IAM Role ì´ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.<br>
í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ì•„ë˜ ì½”ë“œëŠ” ì „ë¶€ ì‚­ì œ í›„ ì£¼ì„ì²˜ë¦¬í•œ ì½”ë“œëŠ” ì£¼ì„ì„ í•´ì œí•œë‹¤.<br>
access key ì™€ secret key ëŠ” local ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ëë‚˜ë©´ ì‚­ì œí•  ê²ƒì´ë¯€ë¡œ í•˜ë“œì½”ë”© í–ˆë‹¤.<br>

## AwsS3Service

```java
@Service
public class AwsS3Service {
    @Value("${cloud.aws.s3.bucket}")
    private String bucket;

    private final S3Client s3Client;
    private final S3Presigner s3Presigner;

    public AwsS3Service(S3Client s3Client, S3Presigner s3Presigner) {
        this.s3Client = s3Client;
        this.s3Presigner = s3Presigner;
    }

    public String uploadFile(MultipartFile multipartFile){

        // null ê²€ì‚¬
        // ë§Œì•½ file ì´ null ì´ë©´ isEmpty ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì—¬ 500 ì‘ë‹µì„ ë³´ë‚´ê³  ì¢…ë£Œ.
        // null ì´ ì•„ë‹ˆë©´ isEmpty(), getSize() ì •ìƒ ìˆ˜í–‰ë˜ê³  ë„˜ì–´ê°.
        try {
            System.out.println("multipartFile == null : " + (multipartFile == null));
            System.out.println("multipartFile.isEmpty() : " + multipartFile.isEmpty());
            System.out.println("multipartFile.getSize() :" + multipartFile.getSize());
        } catch (Exception e) {
            System.out.println("ì˜ˆì™¸: " + e.getMessage());
            throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR, "ì˜ˆì™¸: " + e.getMessage());
        }

        String fileName = createFileName(multipartFile.getOriginalFilename());
        try(InputStream inputStream = multipartFile.getInputStream()){
            PutObjectRequest putObjectRequest = PutObjectRequest.builder()
                    .bucket(bucket)
                    .key(fileName)
                    .contentLength(multipartFile.getSize())
                    .contentType(multipartFile.getContentType())
                    .build();
            s3Client.putObject(putObjectRequest, RequestBody.fromInputStream(inputStream, multipartFile.getSize()));
        } catch (IOException e){
            throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR, "íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        } catch (Exception e) {
            throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR, "ì˜ˆì™¸: " + e.getMessage());
        }

        return fileName;
    }

    public String createFileName(String fileName){
        return UUID.randomUUID().toString().concat(getFileExtension(fileName));
    }

    private String getFileExtension(String fileName){
        try{
            return fileName.substring(fileName.lastIndexOf("."));
        } catch (StringIndexOutOfBoundsException e){
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "ì˜ëª»ëœ í˜•ì‹ì˜ íŒŒì¼" + fileName + ") ì…ë‹ˆë‹¤.");
        }
    }

    public void deleteFile(String fileName){
        DeleteObjectRequest deleteObjectRequest = DeleteObjectRequest.builder()
                .bucket(bucket)
                .key(fileName)
                .build();
        s3Client.deleteObject(deleteObjectRequest);
        System.out.println(bucket);
    }

    public String getPrisignedUrl(String filename) {
        if(filename == null || filename.equals(""))
            return null;

        GetObjectRequest getObjectRequest = GetObjectRequest.builder()
                .bucket(bucket)
                .key(filename)
                .build();

        GetObjectPresignRequest getObjectPresignRequest = GetObjectPresignRequest.builder()
                .signatureDuration(Duration.ofMinutes(5)) // presignedURL 5ë¶„ê°„ ì ‘ê·¼ í—ˆìš©
                .getObjectRequest(getObjectRequest)
                .build();

        PresignedGetObjectRequest presignedGetObjectRequest = s3Presigner
                .presignGetObject(getObjectPresignRequest);

        String url = presignedGetObjectRequest.url().toString();

        s3Presigner.close(); // presignerë¥¼ ë‹«ê³  íšë“í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ í•´ì œ
        return url;
    }
}
```


```java
// uploadFile ë©”ì„œë“œ ì¤‘ ì¼ë¶€
try(InputStream inputStream = multipartFile.getInputStream()){
            PutObjectRequest putObjectRequest = PutObjectRequest.builder()
                    .bucket(bucket)
                    .key(fileName)
                    .contentLength(multipartFile.getSize())
                    .contentType(multipartFile.getContentType())
                    .build();
            s3Client.putObject(putObjectRequest, RequestBody.fromInputStream(inputStream, multipartFile.getSize()));
        } catch (IOException e){ }
```

- uploadFile ë©”ì„œë“œ

PutObjectRequest ê°ì²´ì— ê°’ì„ ì €ì¥í•  file ì˜ ì •ë³´ì™€ ëª©ì ì§€(bucket name) ì„ ì‘ì„±í•œë‹¤.<br>
s3Client.putObject(ì •ë³´, file) ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ file ì„ bucket ìœ¼ë¡œ ì „ë‹¬í•œë‹¤.<br>

- deleteFile ë©”ì„œë“œ

uploadFile ë©”ì„œë“œì˜ putObject ì™€ ë°©ë²•ì´ ë™ì¼í•˜ë‹¤.<br>

- getpresignedUrl ë©”ì„œë“œ

upload í•  ë•Œì™€ ë‹¤ë¥´ê²Œ ë‹¤ìš´ë¡œë“œí•  ë•ŒëŠ” presigned URL ì„ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ ë‹¨ê³„ê°€ ì¡°ê¸ˆ ë‹¤ë¥´ë‹¤.<br>
ë‹¤ìš´ë¡œë“œ í•˜ê¸¸ ì›í•˜ëŠ” file ì˜ ì´ë¦„ì„ ê°€ì§€ê³  GetObjectRequest ë¥¼ ë§Œë“œëŠ” ê²ƒ ê¹Œì§€ëŠ” ë™ì¼í•˜ë‹¤. ê·¸ë¦¬ê³  ê·¸ ê°ì²´ë¥¼ GetObjectPresignRequest ê°ì²´ë¥¼ ìƒì„±í•˜ë©° ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì–´ì¤€ë‹¤.<br>
ìµœì¢…ì ìœ¼ë¡œ s3Presigner.presignGetObject(getObjectPresignRequest) ë¥¼ í˜¸ì¶œí•´ì£¼ë©´ S3 ì—ì„œ í•´ë‹¹ file ì˜ presigned URL ì„ ê±´ë„¤ì¤€ë‹¤.<br>
ê·¸ URL ì„ ì£¼ì†Œì°½ì— ë„£ìœ¼ë©´ S3 ì— ìˆëŠ” file ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.<br>

## AmazonS3Controller 

```java
@RestController
@RequiredArgsConstructor
@RequestMapping("/file")
public class AmazonS3Controller {
 
    private final AwsS3Service awsS3Service;
 
    @PostMapping
    public ResponseEntity<List<String>> uploadFile(List<MultipartFile> multipartFiles){
         return ResponseEntity.ok(awsS3Service.uploadFile(multipartFiles));
    }
 
    @DeleteMapping
    public ResponseEntity<String> deleteFile(@RequestParam String fileName){
        awsS3Service.deleteFile(fileName);
        return ResponseEntity.ok(fileName);
    }
}
```

local í™˜ê²½ì—ì„œ s3 ë¡œ file ì´ ì—…ë¡œë“œ ë˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” controller ì½”ë“œì´ë‹¤.<br>
ë‚˜ëŠ” ê¸°ì¡´ì— file ì„ ì—…ë¡œë“œ í•˜ëŠ” ë¡œì§ì´ ìˆì–´ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤.<br>

## í…ŒìŠ¤íŠ¸

![ì‚¬ì§„12](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/12.png?raw=true)<br>

ê¸°ì¡´ì˜ file ì—…ë¡œë“œ ì½”ë“œì— awsS3Service.uploadFile(file) ë¥¼ ì‚½ì… í›„ í…ŒìŠ¤íŠ¸.

S3 ì— íŒŒì¼ ì—…ë¡œë“œ ëœ ê²ƒì„ í™•ì¸í•˜ì˜€ë‹¤.<br>

## ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ ìˆ˜ì •

```html
<!-- before -->
profilePicture.setAttribute('src', "/uploaded_images/" + img_link);

<!-- after -->
profilePicture.setAttribute('src', img_link);
```

ê¸°ì¡´ ê²½ë¡œëŠ” í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ì¤‘ì¸ í™˜ê²½ì˜ ê²½ë¡œì˜€ë‹¤.<br>
í•˜ì§€ë§Œ ì´ì œ img_link ì—ëŠ” presigned URL ì´ ìˆìœ¼ë¯€ë¡œ ë°”ë¡œ src ì†ì„±ì— ë„£ì–´ì£¼ì—ˆë‹¤.<br>


![ì‚¬ì§„13](https://github.com/Hoon1999/hoon1999.github.io/blob/main/assets/img/2025-08-06-ì´ë¯¸ì§€íŒŒì¼ì €ì¥ê²½ë¡œë¥¼S3ë¡œë³€ê²½/13.png?raw=true)<br>

ê²½ë¡œ ìˆ˜ì • í›„ í…ŒìŠ¤íŠ¸ì‹œ ì›¹í˜ì´ì§€ì— ì •ìƒ ì¶œë ¥ë˜ì—ˆë‹¤.<br>
ìµœì¢…ì ìœ¼ë¡œ Config íŒŒì¼ì˜ access key, secret key ë¥¼ ì‚­ì œ í›„ AWS ì— ë°°í¬í•˜ì—¬ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•˜ì˜€ê³  ì •ìƒì„ì„ í™•ì¸í–ˆë‹¤.<br>

<br>
<hr>
**Reference**

[ìš°ì•„í•œ ê¸°ìˆ  ë¸”ë¡œê·¸ - Spring Bootì—ì„œ S3ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” ì„¸ ê°€ì§€ ë°©ë²•](https://techblog.woowahan.com/11392/)<br>
[Inpa Dev - S3 ê°œë… & ë²„í‚· Â· ê¶Œí•œ ì„¤ì • ë°©ë²•](https://inpa.tistory.com/entry/AWS-ğŸ“š-S3-ë²„í‚·-ìƒì„±-ì‚¬ìš©ë²•-ì‹¤ì „-êµ¬ì¶•)<br>
[ê°œë°œê³¼ ê³ ì–‘ì´ë°œ - Spring Bootë¡œ S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°](https://yel-m.tistory.com/19)<br>